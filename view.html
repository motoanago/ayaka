<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>誕生日リスト</title>
<style>
  body { font-family: Arial, sans-serif; margin: 20px; }
  select { margin-bottom: 20px; padding: 5px; font-size: 16px; }
  table { border-collapse: collapse; width: 100%; }
  th, td { border: 1px solid #ccc; padding: 8px; text-align: left; }
  th { background-color: #f2f2f2; }
</style>
</head>
<body>

<h2>誕生日リスト</h2>
<label for="monthSelect">月を選択:</label>
<select id="monthSelect">
  <option value="ALL">ALL</option>
  <option value="1">1月</option>
  <option value="2">2月</option>
  <option value="3">3月</option>
  <option value="4">4月</option>
  <option value="5">5月</option>
  <option value="6">6月</option>
  <option value="7">7月</option>
  <option value="8">8月</option>
  <option value="9">9月</option>
  <option value="10">10月</option>
  <option value="11">11月</option>
  <option value="12">12月</option>
</select>

<table id="birthdayTable">
  <thead>
    <tr>
      <th>名前</th>
      <th>誕生月</th>
      <th>誕生日</th>
      <th>メモ</th>
    </tr>
  </thead>
  <tbody>
  </tbody>
</table>

<script>
// スプレッドシートを公開して得られるJSON URL
const sheetURL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vQf0Ztzp1T1Vf8nV7Dh4ZfR1lL7fWULe1P8RkK3pub1v7I5xQlKj4XkRdfJr6nH6dJ7RX/pub?output=csv";

// CSVを取得して解析する関数
async function fetchSheetData() {
  const res = await fetch(sheetURL);
  const text = await res.text();
  const rows = text.split("\n").map(r => r.split(","));
  // ヘッダーを削除
  rows.shift();
  return rows.map(r => ({
    name: r[0],
    month: parseInt(r[1], 10),
    day: parseInt(r[2], 10),
    memo: r[3] || ""
  }));
}

// 表示関数
function displayData(data, monthFilter) {
  const tbody = document.querySelector("#birthdayTable tbody");
  tbody.innerHTML = "";

  let filtered = data;
  if (monthFilter !== "ALL") {
    filtered = data.filter(d => d.month === parseInt(monthFilter, 10));
  }

  // 月・日でソート
  filtered.sort((a,b) => a.month - b.month || a.day - b.day);

  for (const item of filtered) {
    const tr = document.createElement("tr");
    tr.innerHTML = `<td>${item.name}</td><td>${item.month}</td><td>${item.day}</td><td>${item.memo}</td>`;
    tbody.appendChild(tr);
  }
}

// 初期表示
let birthdayData = [];
fetchSheetData().then(data => {
  birthdayData = data;
  displayData(birthdayData, "ALL");
});

// プルダウン変更時
document.getElementById("monthSelect").addEventListener("change", e => {
  displayData(birthdayData, e.target.value);
});
</script>

</body>
</html>
